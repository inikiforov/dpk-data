{% extends 'base.html' %}

{% block content %}
<section style="margin-bottom: 3rem;">
    <p style="margin-bottom: 0.5rem;">телеграм-канал: <a href="https://t.me/ilya_dpk" target="_blank">дпк инвестиции</a></p>
    <p style="margin-bottom: 0.5rem;">substack: <a href="https://delopahnetkerosinom.substack.com/" target="_blank">дело пахнет керосином</a></p>
    <p style="font-size: 1.1rem; max-width: 600px;">
        частный инвестор, веду открытые личные портфели, показываю все как есть, ничего не продаю, криптоскептик,
        OpenAIскептик
    </p>
</section>

<hr style="border: 0; border-top: 1px solid var(--border-color); margin-bottom: 3rem;">

<section>
    <h2 class="section-title" style="border: none; font-size: 1.1rem; margin-bottom: 1rem;">про себя</h2>
    <p>
        Меня зовут Илья. Пишу в интернете об инвестициях, карьере, цайтгайсте с 2014 года. По образованию - инженер. MBA
        от Instituto de Empresa в Испании. Веду проекты по внедрению ИИ и ML в энергетической отрасли.
    </p>
    <p>
        Сейчас: занимаюсь расширением своего инвестиционного портфеля. Строю новый портфель с активными инвестициями, сток-пикингом и поиском недооценных компаний. 
        Все делаю самостоятельно, т.к. вижу потенциал для индивидуальных инвесторов в примении ИИ для инвестиционного анализа.
    </p>
    <p>
        + я верю в данные и в чуйку. Где-то на пересечении анализа и житейской интуции рождаются лучшие решения.
    </p>
</section>

<hr style="border: 0; border-top: 1px solid var(--border-color); margin-bottom: 3rem;">

<section>
    <h2 class="section-title" style="border: none; font-size: 1.1rem; margin-bottom: 1rem;">открытый портфель</h2>
    <p>
        Открытый инвестиционный портфель с активной value-стратегией на рынке США. Покупаю акции компаний, которые мне кажутся недооцененными на рынке. Жду пока рынок оценит их или пока не разочаруюсь в своем выборе.
    </p>
    <p>
        Все позиции открыто отображаются со стоимостью и текущим состоянием. Более подробно можно посмотреть по ссылке ниже.
    </p>
    
    {% if current_holdings %}
    <h3 style="font-size: 0.9rem; color: var(--secondary-text); margin-top: 2rem; margin-bottom: 0.5rem;">текущие позиции</h3>
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 2px solid var(--text-color); text-align: left;">
                    <th style="padding: 0.75rem 0.5rem;">Ticker</th>
                    <th style="padding: 0.75rem 0.5rem; text-align: right;">Weight</th>
                    <th style="padding: 0.75rem 0.5rem; text-align: right;">Shares</th>
                    <th style="padding: 0.75rem 0.5rem; text-align: right;">Avg Cost</th>
                    <th style="padding: 0.75rem 0.5rem; text-align: right;">Price</th>
                    <th style="padding: 0.75rem 0.5rem; text-align: right;">Value</th>
                    <th style="padding: 0.75rem 0.5rem; text-align: right;">Unrealized</th>
                </tr>
            </thead>
            <tbody>
                {% for h in current_holdings %}
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <td style="padding: 0.75rem 0.5rem; font-weight: 600;">{{ h.ticker }}</td>
                    <td style="padding: 0.75rem 0.5rem; text-align: right;">{{ h.weight_pct }}%</td>
                    <td style="padding: 0.75rem 0.5rem; text-align: right;">{{ h.shares }}</td>
                    <td style="padding: 0.75rem 0.5rem; text-align: right;">${{ h.avg_cost|floatformat:2 }}</td>
                    <td style="padding: 0.75rem 0.5rem; text-align: right;">${{ h.current_price|floatformat:2 }}</td>
                    <td style="padding: 0.75rem 0.5rem; text-align: right;">${{ h.current_value|floatformat:0 }}</td>
                    <td style="padding: 0.75rem 0.5rem; text-align: right; color: {% if h.unrealized_pnl_pct >= 0 %}#22c55e{% else %}#ef4444{% endif %};">
                        {% if h.unrealized_pnl_pct >= 0 %}+{% endif %}{{ h.unrealized_pnl_pct|floatformat:2 }}%
                        <span style="opacity: 0.7;">(${% if h.unrealized_pnl >= 0 %}{% endif %}{{ h.unrealized_pnl|floatformat:0 }})</span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
    
    <h3 style="font-size: 0.9rem; color: var(--secondary-text); margin-top: 2rem; margin-bottom: 0.5rem;">стоимость портфеля</h3>
    <div id="chart-value-mini" style="height: 350px;"></div>
    
    <p style="margin-top: 1rem;">
        <a href="{% url 'portfolio_public' %}" style="color: var(--link-color);">подробнее о портфеле &rarr;</a>
    </p>
</section>

<hr style="border: 0; border-top: 1px solid var(--border-color); margin-bottom: 3rem;">

<section>
    <p style="color: var(--secondary-text); margin-top: 1rem;">
        с 2014 года
    </p>
</section>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const weeklyData = {{ weekly_chart_data|safe }};
    
    if (weeklyData.value && weeklyData.value.length > 0) {
        new ApexCharts(document.querySelector("#chart-value-mini"), {
            chart: {
                type: 'area',
                height: 350,
                toolbar: { show: false },
                background: 'transparent',
                animations: { enabled: false }
            },
            dataLabels: { enabled: false },
            series: [{ name: 'Стоимость', data: weeklyData.value }],
            stroke: { curve: 'smooth', width: 2 },
            fill: {
                type: 'gradient',
                gradient: { shadeIntensity: 1, opacityFrom: 0.4, opacityTo: 0.1 }
            },
            colors: ['#3b82f6'],
            xaxis: {
                type: 'datetime',
                labels: { 
                    style: { colors: '#888' },
                    datetimeFormatter: { year: 'yyyy', month: "MMM 'yy", day: 'dd MMM' }
                }
            },
            yaxis: { 
                labels: { 
                    style: { colors: '#888' },
                    formatter: (val) => '$' + (val/1000).toFixed(0) + 'k'
                }
            },
            grid: { borderColor: '#333' },
            tooltip: { 
                theme: 'dark',
                x: { format: 'MMM dd, yyyy' },
                y: { formatter: (val) => '$' + val.toLocaleString() }
            }
        }).render();
    }
});
</script>
{% endblock %}