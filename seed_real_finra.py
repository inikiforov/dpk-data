import os
import django
import sys

# Set up Django environment
sys.path.append(os.path.dirname(os.path.abspath(__file__)))
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')
django.setup()

from core.models import FintestQuestion

def seed_real_finra():
    print("Deactivating legacy questions...")
    # Deactivate all existing questions
    FintestQuestion.objects.update(is_active=False)
    
    # 11 Questions from the user-provided PDF
    real_questions = [
        # Q1
        {
            'order': 1,
            'text': "Если вы покупаете акции компании:",
            'option_a': "Вы владеете частью компании",
            'option_b': "Вы дали компании денег в долг",
            'option_c': "Вы несете ответственность по долгам компании",
            'option_d': "Не знаю",
            'option_e': "",
            'correct': 'A',
            'explanation': "Покупка акций (equity) означает приобретение доли в собственности компании."
        },
        # Q2
        {
            'order': 2,
            'text': "Если вы покупаете облигации компании:",
            'option_a': "Вы владеете частью компании",
            'option_b': "Вы дали компании денег в долг",
            'option_c': "Вы несете ответственность по долгам компании",
            'option_d': "Не знаю",
            'option_e': "",
            'correct': 'B',
            'explanation': "Облигация — это долговая расписка. Покупая её, вы фактически одалживаете деньги эмитенту."
        },
        # Q3
        {
            'order': 3,
            'text': "В целом, приносят ли более рискованные инвестиции более высокую доходность с течением времени, чем инвестиции с меньшим риском?",
            'option_a': "Правда",
            'option_b': "Ложь",
            'option_c': "Не знаю",
            'option_d': "",
            'option_e': "",
            'correct': 'A',
            'explanation': "Чтобы инвесторы согласились на риск, актив должен предлагать «премию за риск» — более высокую потенциальную доходность."
        },
        # Q4
        {
            'order': 4,
            'text': "Если компания объявляет о банкротстве, какая из следующих ценных бумаг больше всего рискует стать полностью бесполезной?",
            'option_a': "Привилегированные акции компании",
            'option_b': "Обыкновенные акции компании",
            'option_c': "Облигации компании",
            'option_d': "Не знаю",
            'option_e': "",
            'correct': 'B',
            'explanation': "Кредиторы (владельцы облигаций) и владельцы привилегированных акций имеют приоритет при банкротстве. Владельцы обыкновенных акций получают остатки последними, часто — ничего."
        },
        # Q5
        {
            'order': 5,
            'text': "Что лучше всего объясняет, почему доходность муниципальных облигаций часто ниже, чем у других гособлигаций?",
            'option_a': "Они менее рискованные",
            'option_b': "На них выше спрос",
            'option_c': "Они могут быть освобождены от налогов",
            'option_d': "Не знаю",
            'option_e': "",
            'correct': 'C',
            'explanation': "Муниципальные облигации в США (и ряде других стран) часто имеют налоговые льготы, поэтому инвесторы готовы покупать их с меньшей номинальной доходностью."
        },
        # Q6
        {
            'order': 6,
            'text': "Вы инвестируете $500, чтобы купить акции на $1000 (используя маржу/кредит). Стоимость акций падает на 50%. Сколько ваших первоначальных вложений останется в итоге?",
            'option_a': "$500",
            'option_b': "$250",
            'option_c': "$0",
            'option_d': "Не знаю",
            'option_e': "",
            'correct': 'C',
            'explanation': "Акции стоили $1000, упали на 50% до $500. Ваш долг брокеру по-прежнему $500. Результат: $500 (активы) - $500 (долг) = $0."
        },
        # Q7
        {
            'order': 7,
            'text': "Какое определение лучше всего описывает «продажу в шорт» (selling short)?",
            'option_a': "Продажа акций вскоре после покупки",
            'option_b': "Продажа акций до того, как они достигли пика",
            'option_c': "Продажа акций с убытком",
            'option_d': "Продажа заимствованных акций",
            'option_e': "Не знаю",
            'correct': 'D',
            'explanation': "Шорт — это когда вы берете акции в долг у брокера и продаете их, надеясь откупить позже дешевле и вернуть долг."
        },
        # Q8
        {
            'order': 8,
            'text': "За 20-летний период (2002–2022), что показало наилучшую среднюю доходность?",
            'option_a': "Акции (Stocks)",
            'option_b': "Облигации (Bonds)",
            'option_c': "Депозитные сертификаты (CDs)",
            'option_d': "Счета денежного рынка",
            'option_e': "Драгметаллы",
            'correct': 'A',
            'explanation': "На длинных горизонтах акции исторически значительно обгоняют облигации, золото и денежные вклады."
        },
        # Q9
        {
            'order': 9,
            'text': "В чем главное преимущество индексных фондов по сравнению с активно управляемыми фондами?",
            'option_a': "Они обычно менее рискованны",
            'option_b': "У них обычно ниже комиссии и расходы",
            'option_c': "Они реже падают в цене",
            'option_d': "Не знаю",
            'option_e': "",
            'correct': 'B',
            'explanation': "Индексные фонды просто копируют состав индекса, не тратясь на дорогих аналитиков и управляющих, поэтому их комиссии (Expense Ratio) значительно ниже."
        },
        # Q10
        {
            'order': 10,
            'text': "Прошлые результаты инвестиций являются надежным индикатором будущих результатов.",
            'option_a': "Правда",
            'option_b': "Ложь",
            'option_c': "Не знаю",
            'option_d': "",
            'option_e': "",
            'correct': 'B',
            'explanation': "Это базовое правило финансов: «Past performance is not indicative of future results». Рынки меняются, и победители прошлого часто становятся аутсайдерами."
        },
        # Q11
        {
            'order': 11,
            'text': "У вас есть опцион Call со страйком $50 на бумагу, которая стоит $60. Опцион истекает сегодня. Какова его стоимость?",
            'option_a': "$10",
            'option_b': "$0",
            'option_c': "$110",
            'option_d': "Не знаю",
            'option_e': "",
            'correct': 'A',
            'explanation': "Стоимость опциона = Текущая цена ($60) - Страйк ($50) = $10. Вы имеете право купить за 50 то, что стоит 60."
        }
    ]

    print(f"Seeding {len(real_questions)} updated FINRA questions from PDF...")
    
    for q in real_questions:
        FintestQuestion.objects.create(
            order=q['order'],
            text=q['text'],
            option_a=q['option_a'],
            option_b=q['option_b'],
            option_c=q['option_c'],
            option_d=q['option_d'],
            option_e=q['option_e'],
            correct_answer=q['correct'],
            explanation=q['explanation'],
            is_active=True
        )
        
    print("Done! Legacy questions are deactivated, 11 new questions are live.")

if __name__ == '__main__':
    seed_real_finra()
